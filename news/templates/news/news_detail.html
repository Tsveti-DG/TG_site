{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="page-container">

    <h1 class="news-title">{{ article.title }}</h1>
    <p class="news-date">{{ article.created_at|date:"d.m.Y H:i" }}</p>

    {# ========== ГАЛЕРИЯ (СНИМКИ) ========== #}
    {% if article.image or article.gallery_images.exists %}
        <div class="news-gallery-grid">

            {# Основна снимка #}
            {% if article.image %}
                <a href="{{ article.image.url }}"
                   class="glightbox"
                   data-gallery="news-{{ article.id }}">
                    <img src="{{ article.image.url }}"
                         alt="{{ article.title }}">
                </a>
            {% endif %}

            {# Допълнителни снимки от GalleryImage #}
            {% for img in article.gallery_images.all %}
                <a href="{{ img.image.url }}"
                   class="glightbox"
                   data-gallery="news-{{ article.id }}"
                   data-title="{{ img.caption|default:'' }}">

                    <img src="{{ img.image.url }}"
                         alt="{{ img.caption }}">
                    <!-- {% if img.caption %}
                        <span>{{ img.caption }}</span>
                    {% endif %} -->
                </a>
            {% endfor %}

        </div>
    {% endif %}


    {# ========== ВИДЕА (YOUTUBE) ========== #}
    {% if article.gallery_videos.exists %}
        <div class="news-gallery-grid">

            {% for video in article.gallery_videos.all %}
                <a href="{{ video.video_url }}"
                   class="glightbox"
                   data-type="video"
                   data-gallery="news-{{ article.id }}"
                   data-title="{{ video.title|default:'Видео' }}">

                    <div class="news-video-wrapper">
                        <img src="https://img.youtube.com/vi/{{ video.video_url|cut:'https://www.youtube.com/watch?v='|cut:'https://youtu.be/' }}/hqdefault.jpg"
                             alt="{{ video.title|default:'Видео' }}"
                             class="news-video-thumbnail">
                        <div class="news-video-play-icon">▶</div>
                    </div>

                </a>
            {% endfor %}

        </div>
    {% endif %}


    {# ========== ТЕКСТ ========== #}
    <div class="news-detail-content">
        {{ article.content|linebreaks }}
    </div>


    {# ========== СВЪРЗАНИ АЛБУМИ ========== #}
    {% if related_albums %}
        <div class="related-albums-block">
            <h3>Свързани фото албуми</h3>

            <ul class="related-albums-list">
                {% for album in related_albums %}
                    <li>
                        <a href="{% url 'gallery:gallery_detail' album.code %}">
                            {{ album.title }}
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}


    <p class="back-to-news">
        <a class="read-more" href="{% url 'news:news_list' %}">
            ← Обратно към новините
        </a>
    </p>

</div>
{% endblock %}
